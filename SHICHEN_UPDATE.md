# 时辰选择功能更新说明

## 🎯 更新内容

### 1. 时辰显示格式优化

**更新前**：
```
子时
丑时
寅时
...
```

**更新后**：
```
子时（23:00-01:00）
丑时（01:00-03:00）
寅时（03:00-05:00）
卯时（05:00-07:00）
辰时（07:00-09:00）
巳时（09:00-11:00）
午时（11:00-13:00）
未时（13:00-15:00）
申时（15:00-17:00）
酉时（17:00-19:00）
戌时（19:00-21:00）
亥时（21:00-23:00）
```

### 2. 新增"吉时"选项

为了应对用户不知道具体出生时辰的情况，新增了特殊选项：

```
吉时（时辰未知）
```

**特点**：
- **value值**: 99（区别于正常时辰的0-11）
- **默认选项**: 现在创建订单时，默认选择"吉时（时辰未知）"
- **八字处理**: 选择"吉时"时，只计算年月日三柱，时柱显示为"时辰未知"

## 📊 数据结构

### 时辰数据格式

```javascript
{
  name: '子时（23:00-01:00）',      // 显示名称（含时间段）
  value: 0,                          // 时辰值（0-11正常，99为吉时）
  earthlyBranch: '子',               // 地支
  displayName: '子时'                // 简短名称
}
```

### 特殊值说明

| 时辰 | value | 说明 |
|------|-------|------|
| 子时 | 0 | 23:00-01:00 |
| 丑时 | 1 | 01:00-03:00 |
| ... | 2-10 | ... |
| 亥时 | 11 | 21:00-23:00 |
| **吉时** | **99** | **时辰未知（特殊值）** |

## 🔧 八字计算逻辑

### 正常时辰（value: 0-11）

计算完整四柱八字：
```
年柱 月柱 日柱 时柱
庚午 辛巳 甲子 庚午
```

### 吉时（value: 99）

只计算前三柱，时柱显示为"时辰未知"：
```
年柱 月柱 日柱 时辰未知
庚午 辛巳 甲子 时辰未知
```

**后端处理**：
- 使用正午时（12:00）作为默认时间计算年月日柱
- 时柱不进行实际计算
- 五行信息：年月日正常，时辰标记为"未知"

## 📱 用户体验优化

### 1. 默认选择
- 新增人员时自动选择"吉时（时辰未知）"
- 减少用户疑惑，避免随意选择时辰

### 2. 选择器顺序
时辰选择器显示顺序：
1. 子时（23:00-01:00）
2. 丑时（01:00-03:00）
3. ...
4. 亥时（21:00-23:00）
5. **吉时（时辰未知）** ← 最后一项

### 3. 时间提示
每个时辰都标注了具体时间段，方便用户根据出生时间选择

## 📂 修改的文件

### 前端文件
1. [miniprogram/utils/mockData.js](miniprogram/utils/mockData.js)
   - 更新模拟时辰数据

2. [miniprogram/pages/order-create/order-create.js](miniprogram/pages/order-create/order-create.js)
   - 修改默认时辰为"吉时（时辰未知）"
   - 初始化人员时使用 `shichen_value: 99`

### 后端文件
3. [backend/src/utils/bazi.js](backend/src/utils/bazi.js)
   - 更新 SHICHEN 常量，添加时间段和"吉时"
   - 修改 calculateBazi 函数，特殊处理 value=99 的情况
   - 更新 getShichenList 函数，返回完整信息

## 🧪 测试建议

### 测试用例

1. **正常时辰测试**
   - 选择"午时（11:00-13:00）"
   - 预期：完整八字四柱

2. **吉时测试**
   - 选择"吉时（时辰未知）"
   - 预期：只显示年月日三柱，时柱为"时辰未知"

3. **默认值测试**
   - 创建新订单
   - 预期：默认选中"吉时（时辰未知）"

4. **多人员测试**
   - 添加多位人员
   - 分别选择不同时辰（含吉时）
   - 预期：每位人员独立显示各自的八字信息

## 💡 使用场景

### 适合选择"吉时"的情况

1. **完全不知道出生时辰**
   - 用户只知道出生日期，不知道具体时间

2. **大致知道但不确定**
   - 例如：知道是"中午"但不确定是午时还是未时

3. **历史久远无法考证**
   - 父母、祖辈的出生信息

### 建议用户选择具体时辰的情况

1. **有准确的出生证明**
2. **父母记得清楚**
3. **需要精确八字推算**

## 📝 数据库字段说明

### order_persons 表

```sql
shichen_value INT NOT NULL COMMENT '时辰值（0-11正常时辰，99为吉时）'
shichen_name VARCHAR(10) NOT NULL COMMENT '时辰名称'
bazi_hour VARCHAR(10) DEFAULT '' COMMENT '时柱（吉时情况下为"时辰未知"）'
```

## 🎨 UI 显示示例

### 订单详情页显示

**正常时辰**：
```
姓名：张三
出生时辰：午时（11:00-13:00）
八字：庚午 辛巳 甲子 庚午
```

**吉时**：
```
姓名：李四
出生时辰：吉时（时辰未知）
八字：庚午 辛巳 甲子 时辰未知
```

---

**更新日期**: 2024-01-20
**版本**: v1.1
